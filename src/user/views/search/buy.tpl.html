<?php
/*
 * $Id$
 */

	$partViewer->view('_parts/js', Model::create()->set('name', 'selector'));

	$simpleList = array();
	for ($number = 1; $number < 5; $number ++)
		$simpleList[$number] = $number;
	
	$priceList = array();
	for ($number = 100000; $number < 500000; $number += 100000)
		$priceList[$number] = $number;

	// TODO: add to object builder fetch collection and store in interanl array
?>
	<br/>
	
	<div class="g_6 fields" style="background-acolor: #FFE6B6">
		<form name="searchForm" id="searchForm" action="<?=PATH_WEB?>" method="POST">
		<input type="hidden" name="status" value="<?=OfferType::BUY?>"/>
		
		<div class="g_6 alpha omega">
			
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'property',
				'label'	=> "Property type",
				'list'	=> $propertyTypeList,
				'value'	=> $property->getId()
			))
	);
?>
		</div>
		<div class="clear"></div>
		
		<div class="g_3 alpha">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::BEDROOMS.'][min]',
				'label'	=> "Min Bedrooms",
				'list'	=> $simpleList,
				'topOption'	=> 'Any',
			))
	);
?>
		</div>
				
		<div class="g_3 omega">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::BEDROOMS.'][max]',
				'label'	=> "Max Bedrooms",
				'list'	=> $simpleList,
				'topOption'	=> 'Any',
			))
	);
?>
		</div>
		
		<div class="clear"></div>

		<div class="g_3 fields alpha">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::PRICE.'][min]',
				'label'	=> "Min Price",
				'list'	=> $priceList,
				'topOption'	=> 'Any',
			))
	);
?>
		</div>

		<div class="g_3 fields omega">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::PRICE.'][max]',
				'label'	=> "Max Price",
				'list'	=> $priceList,
				'topOption'	=> 'Any',
			))
	);
?>
		</div>

		<div class="clear"></div>
		
		<div class="g_3 alpha">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::TOYLETS.']',
				'label'	=> "Toylets",
				'list'	=> $simpleList,
				'topOption'	=> 'Any',
			))
	);
?>
		</div>

		<div class="g_3 fields omega">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::CAR_PLACES.']',
				'label'	=> "Min Parkplaces",
				'list'	=> $simpleList,
				'topOption'	=> 'Any',
			))
	);
?>
		</div>

	</form>		

	</div>


	
	<div class="g_18">
<?php
	$subModel = Model::create()->set('size', ImageSize::forList());

	foreach ($relevance as $id => $relevance) {
		$item = $list[$id];
		$subModel->set('picture', $item->getImage());
		$features = $item->getFeatures()->getList();
?>
		<div class="g_12 alpha omega infoBlock">
			<div class="title">
				<?=$item->getPropertyType()->getName()?> in <?=$item->getLocation()->getName()?>
				<div style="float: right; font: 12px sans-serif">Published: <?=$item->getPublished()->toDate()?></div>
			</div>
			<div class="clear"></div>

			<div class="g_6 alpha"><?$partViewer->view('_parts/picture', $subModel)?></div>
			<div class="g_6 omega">
				<h3><?=$item->getName()?></h3>
				<div class="clear"></div>

				<dl>
<?php
		$first = true;
		foreach(array(FeatureType::BEDROOMS, FeatureType::TOYLETS, FeatureType::CAR_PLACES) as $typeId) {
?>
					<dd title="<?=$features[$typeId]->getType()->getDisplayName()?>" class="type<?=$typeId?><?=$first ? ' alpha' : null?>"><div><?=$features[$typeId]->getValue()?></div></dd>
<?php
			$first = false;
		}

		if (false && isset($features[FeatureType::AREA])) {
?>
					<dd class="square"><div>Area: <?=$features[FeatureType::AREA]->getValue()?> m<sup>2</sup></div></dd>
<?php
		}
?>
				</dl>
				<div class="clear"></div>

				<div style="color: #ffc251; font: bold 2em sans-serif">&euro; <?=number_format($features[FeatureType::PRICE]->getValue(), 0, null, "'")?></div>

				<div><?=StringHelper::cut($item->getDescription())?></div>

			</div>
		</div>
		<div class="clear"></div>
		<br/>

<?php
	}
?>
	</div>