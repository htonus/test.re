<?php
/*
 * $Id$
 */

	$partViewer->view('_parts/js', Model::create()->set('name', 'selector'));

	$bedsList = array();
	for ($number = 1; $number < 6; $number ++)
		$bedsList[$number] = $number;

	$priceList = array();
	for ($number = 100000; $number < 500000; $number += 100000)
		$priceList[$number] = $number;

?>

<div class="container_24">

	<!-- Main Form -->
	<div class="g_16">

		<form action="/property/<?=$form->getValue('id') ? 'save' : 'add'?>/<?=$form->getActualValue('offer')->getName()?>" method="POST">

		<div class="g_10 alpha">
<?php
	$partViewer->view(
		'_parts/form/input',
		Model::create()->
			set('params', array(
				'name'	=> 'name',
				'label'	=> "Title",
			))
	);
?>
		</div>
		<div class="g_6 omega">
<?php
	$partViewer->view(
		'_parts/form/input',
		Model::create()->
			set('params', array(
				'name'	=> 'city',
				'label'	=> "Location",
			))
	);
?>
		</div>
		<div class="clear"></div>

		<div class="g_4 alpha">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'property',
				'label'	=> "Property type",
				'list'	=> $propertyTypeList,
				'value'	=> PropertyType::PROPERTY,
			))
	);
?>
		</div>
		<div class="g_3">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::BEDROOMS.']',
				'label'	=> "Bedrooms",
				'list'	=> $bedsList,
				'topOption'	=> 'Choose...',
			))
	);
?>
		</div>
		<div class="g_3">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::TOYLETS.']',
				'label'	=> "Toylets",
				'list'	=> $bedsList,
				'topOption'	=> 'Choose...',
			))
	);
?>
		</div>
		<div class="g_3">
<?php
	$partViewer->view(
		'_parts/form/input',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::AREA.']',
				'label'	=> "Area",
				'class'	=> 'area'
			))
	);
?>
		</div>
		<div class="g_3 omega">
<?php
	$partViewer->view(
		'_parts/form/select',
		Model::create()->
			set('params', array(
				'name'	=> 'type['.FeatureType::PARKING.']',
				'label'	=> "Parking places",
				'list'	=> $bedsList,
				'topOption'	=> 'Choose...',
			))
	);
?>
		</div>
		<div class="clear"></div>

		<div class="g_16 alpha omega">
			<fieldset id="images">
				<input type="file" name="file" id="fileButton" multiple="true" style="display: none;"/>
				<label for="images">Property Images (drag & drop in the field below or <span id="fileTrigger">press here</span> to add)</label>
				<div class="input" id="fileContainer" style="height: 200px"><ul id="fileList"></ul></div>
			</fieldset>
		</div>

		</form>
	</div>

	<!-- Useful Hints -->
	<div class="g_10">

	</div>

</div>

<script type="text/javascript">
	$(document).ready(function(){
		ImageLoader.init();
	});

var ImageLoader = {
	trigger:	null,
	button:		null,
	container:	null,
	list:		null,

	init: function(){
		this.button = $('#fileButton');
		this.trigger = $('#fileTrigger');
		this.container = $('#fileContainer');
		this.list = $('#fileList');

		this.trigger.click(function(){
			ImageLoader.button.click();
		});

		this.container.bind({
			dragenter: function(){
				ImageLoader.container.addClass('highlite')
				return false;
			},
			dragover: function(){
				return false;
			},
			dragleave: function(){
				ImageLoader.container.removeClass('highlite')
				return false;
			},
			drop: function(e){
				var dt = e.originalEvent.dataTransfer;
				ImageLoader.container.removeClass('highlite')
				ImageLoader.displayFiles(dt.files);
				return false;
			}
		});
	},

	displayFiles: function(files){
		var self = this;

		$.each(files, function(i, file) {
			if (!file.type.match(/image.*/))
				return true;

			var li = $('<li><div class="image"><img/></div><div class="progress">0%</div></li>')
				.attr('file', file)
				.appendTo(self.list);

			var reader = new FileReader();
			reader.onload = (function(image) {
				return function(e) {
					image.attr('src', e.target.result);
					
					image.load(function(e){
						var img = $(this);
							if (img[0].width > img[0].height) {
								img.width(120);
							} else {
								img.height(120);
							}
						img.parent().parent().show();
					});
				};
			})($('IMG', li));

			reader.readAsDataURL(file);
		});
	},

	upload: function(){
		
	},
	
	uploadFile: function(){
		
	}

}
</script>
