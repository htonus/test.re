<?php
/*
 * $Id$
 */

	$id = $form->getValue('id')
		? $form->getValue('id')->getId()
		: null;
	
	$class = get_class($subject);
?>

<h2><?=$id ? "Update $class $id" : "Add new $class"?></h2>

<?php
	if ($errors = $form->getErrors()) {
		print_r($errors);
	}
?>

<table>
<form name="editForm" action="<?=PATH_WEB_ADMIN?>" method="post">
<input type="hidden" name="area" value="<?=$area?>" />
<input type="hidden" name="action" value="<?=$id ? 'save' : 'add'?>" />
<input type="hidden" name="id" value="<?=$id?>" />
<?php

	foreach ($form->getPrimitiveList() as $name => $primitive) {
		 if ($name == 'id' || $name == 'features')
			 continue;
		 
		 if (($name == 'password') && $id)
			 continue;
?>
	<tr>
		<td align="right"><?=$primitive->isRequired() ? '*' : ''?> <b><?=$name?></b> </td>
		<td>
<?php
		if ($primitive instanceof IdentifiablePrimitive) {
			if (isset(${$name.'List'})) {
?>
			<select name="<?=$name?>">
<?php
			if (!$primitive->isRequired()) {
?>
				<option value=""></option>
<?php
			}
			foreach(${$name.'List'} as $option) {
?>
				<option value="<?=$option->getId()?>"><?=$option->getName()?></option>
<?php
			}
?>
			</select>
<?php
			} elseif (isset(${$name.'Lookup'})) {
				$partViewer->view(
					'_parts/lookup',
					Model::create()->
						set('name', $name)->
						set('class', ${$name.'Lookup'})
				);
			}
		} else {
?>
			<input type="text" name="<?=$name?>" value="<?= $form->getValue($name)?>">
<?php
		}
?>

		</td>
	</tr>
<?php
		
	}
?>

	<tr>
		<td></td>
		<td><input type="submit"></td>
	</tr>
	
</form>
</table>
